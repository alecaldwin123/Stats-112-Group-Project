---
title: "Group Project Stats 112"
author: "Alec, Jay, Lynn"
date: "5/7/2021"
output: html_document
---

##Setup ---

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(nlme)
library(mgcv)
aids = read.csv("aids.csv")

glimpse(aids)
```

##Exploratory Data Analysis --- 

```{r}
subjects = unique(aids$id)
subjects = max(subjects)
```

The number of subjects in the dataset is `r subjects`
The number of the covariates is `r ncol(aids) `

##Univariate summaries 

```{r}
summary(aids)

aids %>% 
  summarize(mean_log_cd4 = mean(log_cd4, na.rm = TRUE), 
            stdev_log_cd4 = sd(log_cd4, na.rm = TRUE))
aids %>% 
  group_by(treatment) %>% 
  summarize(mean_log_cd4 = mean(log_cd4, na.rm = TRUE), 
            stdev_log_cd4 = sd(log_cd4, na.rm = TRUE))
```
We can see that for this longitudinal study, the log_cd4 values range from 0 to 6.29, with a median of 2.9 and a mean of 2.87. The 3rd quantile is around 3.57, but the maximum is 6.297, which may indicate that we have potential outlier. When we look at the overall mean and standard deviation of log(cd4), the mean is around 2.87 and the standard deviation is around 1.07. We can see that the maximum log_cd4 value 6.29 is more than 2 standard deviations away from the overall mean, supporting our estimate that that value could be an outlier in the dataset. We can also see in the upcoming boxplots that there are some outliers.
When we look at the mean and standard deviations of log_cd4 for each treatment group, we can see that as the treatment code increases, the mean and standard deviation of log_cd4 also increases.



```{r}
# Distribution of Age
aids %>% 
  ggplot(aes(x = age)) + 
  geom_histogram(bins = 15, color = "black", fill = "gray")
```


```{r}
# Distribution of people in each treatment group
table(aids$treatment)
round(prop.table(table(aids$treatment)), 2)
```



##Bivariate summaries 
```{r}
#Boxplot based on treatment group
aids %>% 
  ggplot(aes(x = factor(treatment), y = log_cd4, 
             fill = factor(treatment))) +
  geom_boxplot()
```

```{r}
#Boxplot based on gender
aids %>% 
  ggplot(aes(x = gender, y = log_cd4, fill = gender)) +
  geom_boxplot()
```


##Overall trends of response ---

```{r}
# Mean log_cd4 per week of each treatment 

aids %>% 
 group_by(treatment, week) %>% 
 summarize(mean_logcd4 = mean(log_cd4)) %>% 
 ggplot(aes(x = week, y = mean_logcd4,  color =  factor(treatment))) +  
 labs(title = "Smoothed Trend of Each Treatment",
      y = "Mean Log cd4", x = "Week") +
 geom_smooth(se = FALSE) +
  facet_wrap(~treatment)
```

```{r}

# Trends pf each subject per week separated by treatment
aids %>% 
 ggplot(aes(x = week, y = log_cd4, color = factor(treatment)))+
 geom_point(alpha = 0.3) +
 geom_smooth(se = FALSE) +
 labs(title = "Smoothed Trend of Each Subject",
      y = " Log cd4", x = "Week")
```

```{r}
aids %>% 
  group_by(treatment, week) %>% 
  summarize(mean_log_cd4 = mean(log_cd4, na.rm = TRUE)) %>% 
  ggplot(aes(x = week, y = mean_log_cd4, color = factor(treatment))) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", se = FALSE) + 
  labs(x = "Week", y = "Log(CD4)")
```

In this plot, we can see that as the weeks increase, the mean values of log_cd4 for each treatment group stays relatively constant. There does seem to be a large scatter of points that might significantly deviate from the mean.



##Imbalances in the data ---

```{r}
aids %>%
  group_by(id) %>% 
  count() %>% 
  summary()
```

We can see that the number of observations per id ranges from 1 to 9, with a median of 4 and a mean of around 3.8. It is safe to assume that the data is imbalanced, because each subject does not have a constant number of observations.

```{r}
aids %>%
  group_by(treatment) %>% 
  distinct(id) %>% 
  count()
```
We can see that the amount of people in each treatment group is pretty balanced, with each treatment group having around 325 subjects.

#Mistimmed events?
```{r}
aids %>% 
  filter(treatment == 2) %>% 
  ggplot(aes(x = week)) +
  geom_histogram(color = "black", fill = "gray") +
  labs(title = "Week of Treatment 2 group")
```
As we can see from this graph that all of those in treatment two have different timed occasions, if there were a set occasion then it would stack up similar to the base line or at week 0. 

## Outliers ---

We can see from the boxplots above there are quite a few outliers in the log_cd4 per treatment. To see the overall number of outliers we can create a boxplot of the log_cd4 and count the numbers outside of the interquartile range


```{r}
aids %>% 
  ggplot(aes(y = log_cd4)) +
  geom_boxplot()
```
These are the outliers and the total number of outliers are 
```{r}
#outliers values
tibble(outliers = boxplot.stats(aids$log_cd4)$out )

#number of outliers 
observerd = tibble(r = boxplot.stats(aids$log_cd4)$out) %>% 
  nrow()

#expected number of outliers are
expected = nrow(aids) * .05
```
There is about `r observerd` outliers and the expected is `r expected`.
We are below the number of expected number of outliers so the observed outliers are normal.


<p>Let us check the distribution of the log_cd4 and assess its normality</p>
```{r}

aids %>% 
  ggplot(aes(x = log_cd4)) +
   geom_histogram(bins = 15, color = "black", fill = "gray") +
   labs(title = "Histogram of Log_cd4")
  

```

The histogram its approximately normal, but we can get more information but standardizing the log_cd4

```{r}

# Standardized of log_cd4 with mean 0 and sd 1 
log_cd4 = aids$log_cd4

scaled = scale(log_cd4)
colMeans(scaled)
apply(scaled, 2, sd)

tibble(r = scaled) %>% 
  ggplot(aes(x = r)) +
  geom_histogram( color = "black", fill = "gray") +
  labs(title = "Standardized Histogram of Log_cd4")
```

We can see that there is quite a few number of instances after the -2. This indicates heavy tails as well as outliers
